$ ls -la
total 19752
drwxrwxr-x  42 root root  4751360 Sep  1 22:03 .
drwxr-xr-x 252 root root 10764288 Sep  2 03:21 ..
-rw-rw-r--   1 root root      259 Aug 31 08:03 .dockerignore
drwxr-xr-x   3 root root     8192 Sep  1 22:01 .mgx
-rw-rw-r--   1 root root      915 Aug 31 08:03 Dockerfile
-rw-rw-r--   1 root root     4909 Aug 31 08:03 README.md
drwxr-xr-x   3 root root     8192 Sep  1 22:00 __pycache__
drwxrwxr-x   8 root root    45056 Sep  1 21:58 app
-rw-rw-r--   1 root root      448 Sep  1 22:03 app.py
-rw-r--r--   1 root root       22 Sep  1 22:03 available_port.txt
-rw-rw-r--   1 root root      389 Aug 31 08:03 config.py
drwxr-xr-x   3 root root   110592 Sep  1 22:02 data
-rw-rw-r--   1 root root     3405 Aug 31 08:03 deploy.py
-rw-rw-r--   1 root root      788 Aug 31 08:03 docker-compose.yml
-rw-r--r--   1 root root        6 Sep  1 22:03 free_port.txt
drwxrwxr-x  14 root root  2338816 Sep  1 21:58 ml_model
drwxr-xr-x   3 root root  2183168 Sep  1 22:02 models
-rw-rw-r--   1 root root      140 Sep  1 21:58 requirements.txt
-rw-rw-r--   1 root root      355 Aug 31 08:03 template_config.json
-rw-rw-r--   1 root root     1329 Aug 31 08:03 todo.md
$ docker build -t churn-app .

bash: line 4: docker: command not found
$ python -m pytest tests/ -v

Traceback (most recent call last):
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/data/.cache/python/lib/python3.10/site-packages/pytest/__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 150, in main
    config = _prepareconfig(args, plugins)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 331, in _prepareconfig
    config = pluginmanager.hook.pytest_cmdline_parse(
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_hooks.py", line 265, in __call__
    return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_manager.py", line 80, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_callers.py", line 55, in _multicall
    gen.send(outcome)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/helpconfig.py", line 104, in pytest_cmdline_parse
    config: Config = outcome.get_result()
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_result.py", line 60, in get_result
    raise ex[1].with_traceback(ex[2])
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_callers.py", line 39, in _multicall
    res = hook_impl.function(*args)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1075, in pytest_cmdline_parse
    self.parse(args)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1425, in parse
    self._preparse(args, addopts=addopts)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1305, in _preparse
    self.pluginmanager.load_setuptools_entrypoints("pytest11")
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_manager.py", line 287, in load_setuptools_entrypoints
    plugin = ep.load()
  File "/opt/conda/envs/mgx-chat/lib/python3.10/importlib/metadata/__init__.py", line 171, in load
    module = import_module(match.group('module'))
  File "/opt/conda/envs/mgx-chat/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 992, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/assertion/rewrite.py", line 178, in exec_module
    exec(co, module.__dict__)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pytest_asyncio/__init__.py", line 6, in <module>
    from .plugin import fixture, is_async_test
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/assertion/rewrite.py", line 178, in exec_module
    exec(co, module.__dict__)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pytest_asyncio/plugin.py", line 37, in <module>
    from pytest import (
ImportError: cannot import name 'FixtureDef' from 'pytest' (/data/.cache/python/lib/python3.10/site-packages/pytest/__init__.py)
$ pip install -r requirements.txt

Requirement already satisfied: Flask==2.3.3 in /data/.cache/python/lib/python3.10/site-packages (from -r requirements.txt (line 1)) (2.3.3)
Requirement already satisfied: scikit-learn==1.3.0 in /data/.cache/python/lib/python3.10/site-packages (from -r requirements.txt (line 2)) (1.3.0)
Requirement already satisfied: pandas==2.0.3 in /data/.cache/python/lib/python3.10/site-packages (from -r requirements.txt (line 3)) (2.0.3)
Requirement already satisfied: numpy==1.24.3 in /data/.cache/python/lib/python3.10/site-packages (from -r requirements.txt (line 4)) (1.24.3)
Collecting joblib==1.3.2
  Downloading joblib-1.3.2-py3-none-any.whl (302 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 302.2/302.2 kB 4.9 MB/s eta 0:00:00
Collecting pytest==6.2.5
  Downloading pytest-6.2.5-py3-none-any.whl (280 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 280.7/280.7 kB 5.4 MB/s eta 0:00:00
Collecting pytest-cov==3.0.0
  Downloading pytest_cov-3.0.0-py3-none-any.whl (20 kB)
Collecting flake8==6.0.0
  Downloading flake8-6.0.0-py2.py3-none-any.whl (57 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 57.8/57.8 kB 472.0 kB/s eta 0:00:00
Requirement already satisfied: Werkzeug>=2.3.7 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Flask==2.3.3->-r requirements.txt (line 1)) (3.1.3)
Requirement already satisfied: Jinja2>=3.1.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Flask==2.3.3->-r requirements.txt (line 1)) (3.1.6)
Requirement already satisfied: blinker>=1.6.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Flask==2.3.3->-r requirements.txt (line 1)) (1.9.0)
Requirement already satisfied: itsdangerous>=2.1.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Flask==2.3.3->-r requirements.txt (line 1)) (2.2.0)
Requirement already satisfied: click>=8.1.3 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Flask==2.3.3->-r requirements.txt (line 1)) (8.2.1)
Requirement already satisfied: threadpoolctl>=2.0.0 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from scikit-learn==1.3.0->-r requirements.txt (line 2)) (3.6.0)
Requirement already satisfied: scipy>=1.5.0 in /data/.cache/python/lib/python3.10/site-packages (from scikit-learn==1.3.0->-r requirements.txt (line 2)) (1.10.1)
Requirement already satisfied: tzdata>=2022.1 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pandas==2.0.3->-r requirements.txt (line 3)) (2025.2)
Requirement already satisfied: pytz>=2020.1 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pandas==2.0.3->-r requirements.txt (line 3)) (2025.2)
Requirement already satisfied: python-dateutil>=2.8.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pandas==2.0.3->-r requirements.txt (line 3)) (2.9.0.post0)
Requirement already satisfied: packaging in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (23.0)
Requirement already satisfied: toml in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (0.10.2)
Requirement already satisfied: pluggy<2.0,>=0.12 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (1.6.0)
Requirement already satisfied: iniconfig in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (2.1.0)
Requirement already satisfied: attrs>=19.2.0 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (25.3.0)
Requirement already satisfied: py>=1.8.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest==6.2.5->-r requirements.txt (line 6)) (1.11.0)
Requirement already satisfied: coverage[toml]>=5.2.1 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from pytest-cov==3.0.0->-r requirements.txt (line 7)) (7.9.1)
Collecting pyflakes<3.1.0,>=3.0.0
  Downloading pyflakes-3.0.1-py2.py3-none-any.whl (62 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 62.8/62.8 kB 1.5 MB/s eta 0:00:00
Requirement already satisfied: mccabe<0.8.0,>=0.7.0 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from flake8==6.0.0->-r requirements.txt (line 8)) (0.7.0)
Collecting pycodestyle<2.11.0,>=2.10.0
  Downloading pycodestyle-2.10.0-py2.py3-none-any.whl (41 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 41.3/41.3 kB 440.5 kB/s eta 0:00:00
Requirement already satisfied: tomli in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from coverage[toml]>=5.2.1->pytest-cov==3.0.0->-r requirements.txt (line 7)) (2.2.1)
Requirement already satisfied: MarkupSafe>=2.0 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Jinja2>=3.1.2->Flask==2.3.3->-r requirements.txt (line 1)) (3.0.2)
Requirement already satisfied: six>=1.5 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from python-dateutil>=2.8.2->pandas==2.0.3->-r requirements.txt (line 3)) (1.16.0)
Installing collected packages: pytest, pyflakes, pycodestyle, joblib, pytest-cov, flake8
  Attempting uninstall: pytest
    Found existing installation: pytest 7.4.2
    Uninstalling pytest-7.4.2:
      Successfully uninstalled pytest-7.4.2
  Attempting uninstall: joblib
    Found existing installation: joblib 1.5.1
    Uninstalling joblib-1.5.1:
      Successfully uninstalled joblib-1.5.1
  Attempting uninstall: pytest-cov
    Found existing installation: pytest-cov 6.2.1
    Uninstalling pytest-cov-6.2.1:
      Successfully uninstalled pytest-cov-6.2.1
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
pytest-xdist 3.7.0 requires pytest>=7.0.0, but you have pytest 6.2.5 which is incompatible.
pytest-timeout 2.4.0 requires pytest>=7.0.0, but you have pytest 6.2.5 which is incompatible.
pytest-metadata 3.1.1 requires pytest>=7.0.0, but you have pytest 6.2.5 which is incompatible.
pytest-html 4.1.1 requires pytest>=7.0.0, but you have pytest 6.2.5 which is incompatible.
pytest-asyncio 1.0.0 requires pytest<9,>=8.2, but you have pytest 6.2.5 which is incompatible.
Successfully installed flake8-6.0.0 joblib-1.3.2 pycodestyle-2.10.0 pyflakes-3.0.1 pytest-6.2.5 pytest-cov-3.0.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv

[notice] A new release of pip is available: 25.0.1 -> 25.2
[notice] To update, run: pip install --upgrade pip
$ python -m pytest tests/ -v

Traceback (most recent call last):
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/data/.cache/python/lib/python3.10/site-packages/pytest/__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 185, in console_main
    code = main()
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 143, in main
    config = _prepareconfig(args, plugins)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 318, in _prepareconfig
    config = pluginmanager.hook.pytest_cmdline_parse(
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_hooks.py", line 265, in __call__
    return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_manager.py", line 80, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_callers.py", line 55, in _multicall
    gen.send(outcome)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/helpconfig.py", line 100, in pytest_cmdline_parse
    config: Config = outcome.get_result()
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_result.py", line 60, in get_result
    raise ex[1].with_traceback(ex[2])
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_callers.py", line 39, in _multicall
    res = hook_impl.function(*args)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1003, in pytest_cmdline_parse
    self.parse(args)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1283, in parse
    self._preparse(args, addopts=addopts)
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/config/__init__.py", line 1172, in _preparse
    self.pluginmanager.load_setuptools_entrypoints("pytest11")
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pluggy/_manager.py", line 287, in load_setuptools_entrypoints
    plugin = ep.load()
  File "/opt/conda/envs/mgx-chat/lib/python3.10/importlib/metadata/__init__.py", line 171, in load
    module = import_module(match.group('module'))
  File "/opt/conda/envs/mgx-chat/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 992, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/assertion/rewrite.py", line 170, in exec_module
    exec(co, module.__dict__)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pytest_asyncio/__init__.py", line 6, in <module>
    from .plugin import fixture, is_async_test
  File "/data/.cache/python/lib/python3.10/site-packages/_pytest/assertion/rewrite.py", line 170, in exec_module
    exec(co, module.__dict__)
  File "/opt/conda/envs/mgx-chat/lib/python3.10/site-packages/pytest_asyncio/plugin.py", line 36, in <module>
    from _pytest.scope import Scope
ModuleNotFoundError: No module named '_pytest.scope'
$ pip uninstall pytest-asyncio -y

Found existing installation: pytest-asyncio 1.0.0
Uninstalling pytest-asyncio-1.0.0:
  Successfully uninstalled pytest-asyncio-1.0.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
$ python -c "
import sys
sys.path.insert(0, '.')
from tests.test_api import *
from tests.test_model import *
import unittest

# Run basic tests manually
if __name__ == '__main__':
    print('Running basic import tests...')
    
    # Test imports
    try:
        from app import create_app
        print('✅ Flask app import successful')
    except Exception as e:
        print(f'❌ Flask app import failed: {e}')
    
    try:
        from ml_model.model_utils import ChurnPredictor
        predictor = ChurnPredictor()
        print('✅ ChurnPredictor import and initialization successful')
    except Exception as e:
        print(f'❌ ChurnPredictor import failed: {e}')
    
    try:
        from app.monitoring import monitor
        print('✅ Monitoring system import successful')
    except Exception as e:
        print(f'❌ Monitoring system import failed: {e}')
    
    try:
        from app.database import db
        print('✅ Database system import successful')
    except Exception as e:
        print(f'❌ Database system import failed: {e}')
    
    print('Basic tests completed!')
"

Running basic import tests...
✅ Flask app import successful
Model loaded successfully. Accuracy: 0.6100
✅ ChurnPredictor import and initialization successful
✅ Monitoring system import successful
✅ Database system import successful
Basic tests completed!
$ python -c "
import requests
import json
import time

# Test the running API
base_url = 'http://127.0.0.1:43687'

print('Testing live API endpoints...')

# Test health endpoint
try:
    response = requests.get(f'{base_url}/health', timeout=5)
    if response.status_code == 200:
        print('✅ Health endpoint working')
        print(f'   Response: {response.json()}')
    else:
        print(f'❌ Health endpoint failed: {response.status_code}')
except Exception as e:
    print(f'❌ Health endpoint error: {e}')

# Test metrics endpoint
try:
    response = requests.get(f'{base_url}/metrics', timeout=5)
    if response.status_code == 200:
        print('✅ Metrics endpoint working')
        metrics = response.json()['metrics']
        print(f'   Total requests: {metrics[\"total_requests\"]}')
        print(f'   Uptime: {metrics[\"uptime_seconds\"]}s')
    else:
        print(f'❌ Metrics endpoint failed: {response.status_code}')
except Exception as e:
    print(f'❌ Metrics endpoint error: {e}')

# Test prediction endpoint
try:
    test_data = {
        'age': 35,
        'tenure': 2.5,
        'monthly_charges': 75.0,
        'total_charges': 1875.0,
        'contract_type': 'Month-to-month',
        'payment_method': 'Electronic check',
        'internet_service': 'Fiber optic',
        'online_security': 'No',
        'tech_support': 'No'
    }
    
    response = requests.post(f'{base_url}/predict', 
                           json=test_data, 
                           timeout=5)
    if response.status_code == 200:
        print('✅ Prediction endpoint working')
        result = response.json()
        pred = result['prediction']
        print(f'   Prediction: {pred[\"churn_prediction\"]}')
        print(f'   Probability: {pred[\"churn_probability\"]:.3f}')
    else:
        print(f'❌ Prediction endpoint failed: {response.status_code}')
        print(f'   Response: {response.text}')
except Exception as e:
    print(f'❌ Prediction endpoint error: {e}')

print('API testing completed!')
"

Testing live API endpoints...
❌ Health endpoint error: HTTPConnectionPool(host='127.0.0.1', port=43687): Max retries exceeded with url: /health (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fe41a992950>: Failed to establish a new connection: [Errno 111] Connection refused'))
❌ Metrics endpoint error: HTTPConnectionPool(host='127.0.0.1', port=43687): Max retries exceeded with url: /metrics (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fe41b697fa0>: Failed to establish a new connection: [Errno 111] Connection refused'))
❌ Prediction endpoint error: HTTPConnectionPool(host='127.0.0.1', port=43687): Max retries exceeded with url: /predict (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fe41a993220>: Failed to establish a new connection: [Errno 111] Connection refused'))
API testing completed!
$ python -c "
import sys
sys.path.insert(0, '.')
try:
    from app.routes import main_bp
    print('✅ main_bp import successful')
except Exception as e:
    print(f'❌ main_bp import failed: {e}')
    
try:
    import app.routes
    print(f'Available attributes in app.routes: {dir(app.routes)}')
except Exception as e:
    print(f'❌ app.routes import failed: {e}')
"

Model loaded successfully. Accuracy: 0.6100
✅ main_bp import successful
Available attributes in app.routes: ['Blueprint', 'ChurnPredictor', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'get_metrics', 'health', 'index', 'jsonify', 'main_bp', 'model_info', 'monitor', 'monitor_requests', 'os', 'predict_batch', 'predict_single', 'predictor', 'render_template_string', 'request', 'retrain_model', 'sys', 'validate_customer_data']
$ python -c "
import sys
sys.path.insert(0, '.')
try:
    from app.monitoring import monitor_requests, monitor
    print('✅ monitoring import successful')
except Exception as e:
    print(f'❌ monitoring import failed: {e}')
    import traceback
    traceback.print_exc()
"

✅ monitoring import successful
